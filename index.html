<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Galmee Barattootaa ‚Äì Mary Help College</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background: linear-gradient(120deg,#1e3c72,#2a5298);
  min-height:100vh;
  padding:20px;
  font-family: "Segoe UI", sans-serif;
}
.card{
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.card-title{
  font-weight:700;
}
.btn-primary{
  background:#2a5298;
  border:none;
}
.btn-primary:hover{
  background:#1e3c72;
}
table{
  font-size:0.95rem;
}
</style>
</head>
<body>

<div class="container">

<!-- REGISTER -->
<div class="card p-4 mb-4">
  <h4 class="card-title text-center mb-3">üìã Galmee Barattootaa Degree Mary help college</h4>

  <div class="row g-3">
    <div class="col-md-6">
      <input id="name" class="form-control" placeholder="Maqaa Guutuu *">
    </div>

    <div class="col-md-6">
      <input id="email" type="email" class="form-control" placeholder="Email (Optional)">
    </div>

    <div class="col-md-6">
      <input id="phone" class="form-control" placeholder="Lakkoofsa Bilbilaa">
    </div>

    <div class="col-md-6">
      <input id="address" class="form-control" placeholder="Teesso Jireenya">
    </div>

    <div class="col-md-6">
      <select id="background" class="form-select">
        <option value="">Gosa Barnootaa Duraanii *</option>
        <option>Social</option>
        <option>Natural</option>
        <option>IT Level 4</option>
        <option>Kan biraa</option>
      </select>
    </div>

    <div class="col-md-6">
      <select id="department" class="form-select">
        <option value="">Department *</option>
        <option>Computer Science</option>
        <option>Information Technology</option>
        <option>Fashion Design</option>
      </select>
    </div>

    <div class="col-12">
      <button onclick="registerStudent()" class="btn btn-primary w-100">
        Galmaa'i
      </button>
    </div>
  </div>
</div>

<!-- TABLE -->
<div class="card p-3">
  <h5 class="text-center mb-3">üìä Tarree Barattootaa</h5>
  <div class="table-responsive">
    <table class="table table-bordered text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Maqaa</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Address</th>
          <th>Background</th>
          <th>Department</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="table"></tbody>
    </table>
  </div>
</div>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBkJhZAvzjGObr_aKslxVR4g4ZruOSSYvQ",
  authDomain: "oromia-state-university-3713a.firebaseapp.com",
  databaseURL: "https://oromia-state-university-3713a-default-rtdb.firebaseio.com",
  projectId: "oromia-state-university-3713a",
  storageBucket: "oromia-state-university-3713a.appspot.com",
  messagingSenderId: "1017046327238",
  appId: "1:1017046327238:web:6203d828c2bdd7fe449cc7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const studentsRef = ref(db,"students");

/* REGISTER */
window.registerStudent = function(){
  const nameVal = document.getElementById("name").value.trim();
  const emailVal = document.getElementById("email").value.trim();
  const phoneVal = document.getElementById("phone").value.trim();
  const addressVal = document.getElementById("address").value.trim();
  const backgroundVal = document.getElementById("background").value;
  const departmentVal = document.getElementById("department").value;

  if(nameVal==="" || backgroundVal==="" || departmentVal===""){
    alert("Maaloo Maqaa, Background fi Department guuti!");
    return;
  }

  push(studentsRef,{
    name: nameVal,
    email: emailVal || "-",
    phone: phoneVal || "-",
    address: addressVal || "-",
    background: backgroundVal,
    department: departmentVal
  });

  clearForm();
}

/* READ */
onValue(studentsRef,(snapshot)=>{
  const table = document.getElementById("table");
  table.innerHTML="";
  let i=1;
  snapshot.forEach(child=>{
    const s = child.val();
    const id = child.key;
    table.innerHTML += `
    <tr>
      <td>${i++}</td>
      <td>${s.name}</td>
      <td>${s.email}</td>
      <td>${s.phone}</td>
      <td>${s.address}</td>
      <td>${s.background}</td>
      <td>${s.department}</td>
      <td>
        <button class="btn btn-warning btn-sm mb-1" onclick="editStudent('${id}')">Edit</button>
        <button class="btn btn-danger btn-sm" onclick="deleteStudent('${id}')">Delete</button>
      </td>
    </tr>`;
  });
});

/* EDIT */
window.editStudent = function(id){
  const pass = prompt("Admin Password:");
  if(pass!=="121212") return alert("Password sirrii miti ‚ùå");

  const newName = prompt("Maqaa haaraa galchi:");
  if(newName){
    update(ref(db,"students/"+id),{name:newName});
  }
}

/* DELETE */
window.deleteStudent = function(id){
  const pass = prompt("Admin Password:");
  if(pass!=="121212") return alert("Password sirrii miti ‚ùå");
  if(confirm("Barataa kana haquu feetaa?")){
    remove(ref(db,"students/"+id));
  }
}

/* CLEAR FORM ‚Äì ERROR FREE */
function clearForm(){
  document.getElementById("name").value="";
  document.getElementById("email").value="";
  document.getElementById("phone").value="";
  document.getElementById("address").value="";
  document.getElementById("background").value="";
  document.getElementById("department").value="";
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>